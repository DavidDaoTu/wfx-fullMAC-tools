<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WF200 FMAC driver: wf200_host_req.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WF200 FMAC driver
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('wf200__host__req_8md.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">wf200_host_req.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Host requirements  {#wf200_host_req}  </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;============</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;A microcontroller host can use the FMAC driver to access the Wi-Fi capabilities of the WF200. In order to do so, the host has several requirements that are described below.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;## Bus communication</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;The first requirement of the host is to support either SPI or SDIO communication.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;### SPI bus</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;The WF200 supports SPI 8-bit up to 50MHz. In addition to the SPI connections (MISO, MOSI, clock), the host will require two GPIOs to manage the chip select and interrupt functionalities. You can refer to \ref wf200_hardware to connect the host to WF200. </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;The chip select is active in the reset state and the interrupt is detected on a rising edge. In case of power save features support, the host will require an additional GPIO (GPIO_WUP) for the wake-up functionality.</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;### SDIO bus</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;The WF200 supports SDIO 4-bit up to 50MHz. By default, the interrupt occurs on the SDIO data line 1. This can be changed using the PDS (\ref wf200_pds) enabling the interrupt on the GPIO_WIRQ pin. This option can be useful in case of power save support. </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;The WF200 follows the SDIO specification ver 2.0. In case of power save features support, the host has to manage an additional GPIO (GPIO_WUP) for the wake-up functionality.</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;## Host memory requirements</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;### Flash memory</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;The firmware 2.0.0 needs 300KB of memory on the host side. It is then sent to the WF200 during the initialization phase. For future proof updates, we recommend to keep at least 350KB free on the host side.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;### RAM memory</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;The RAM memory used to run the driver is small (&lt;1KB for the context structure) and only consists of maintaining WF200 context.</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;## Host API functions implementation</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;The host has to implement a set of functions to enable the driver to access multiple resources (Firmware, GPIOs, memory, busses...). The implementation of these functions are dependent on the platform and type of operating system used.</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;The list of functions required to be implemented by the host are located in the wf200_host_api.h file.</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;The first set of functions is responsible of initializing the host and retrieving the firmware information.</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;```c</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;sl_status_t wf200_host_init( void );</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;sl_status_t wf200_host_get_firmware_data( const uint8_t** data, uint32_t data_size );</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;sl_status_t wf200_host_get_firmware_size( uint32_t* firmware_size );</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;sl_status_t wf200_host_deinit( void );</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;```</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;The host also needs to provide GPIO access to the FMAC driver.</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;```c</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;sl_status_t wf200_host_reset_chip( void );</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;sl_status_t wf200_host_set_wake_up_pin( uint8_t state );</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;sl_status_t wf200_host_hold_in_reset( void );</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;```</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;In addition, several functions serve to manage the confirmations and indications coming from WF200.</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;```c</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;sl_status_t wf200_host_wait_for_confirmation( uint32_t timeout, void** event_payload_out );</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;sl_status_t wf200_host_wait( uint32_t wait_time );</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;sl_status_t wf200_host_post_event( uint32_t event_id, void* event_payload, uint32_t event_payload_length );</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;```</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;These functions allocate or free memory.</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;```c</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;sl_status_t wf200_host_allocate_buffer( wf200_buffer_t** buffer, wf200_buffer_type_t type, uint32_t buffer_size, uint32_t wait_duration );</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;sl_status_t wf200_host_free_buffer( wf200_buffer_t* buffer, wf200_buffer_type_t type );</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;```</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;The last set of required functions are to support the chosen communication bus. </div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;```c</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;/* WF200 host bus API */</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;sl_status_t wf200_host_init_bus( void );</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;sl_status_t wf200_host_enable_platform_interrupt( void );</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;sl_status_t wf200_host_disable_platform_interrupt( void );</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;/* WF200 host SPI bus API */</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;sl_status_t wf200_host_spi_cs_assert( void );</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;sl_status_t wf200_host_spi_cs_deassert(void );</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;sl_status_t wf200_host_spi_transfer_no_cs_assert( sl_wifi_bus_tranfer_type_t type, uint8_t* buffer, uint16_t buffer_length );</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;/* WF200 host SDIO bus API */</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;sl_status_t wf200_host_sdio_transfer_cmd52( wf200_host_bus_tranfer_type_t type, uint8_t function, uint32_t address, uint8_t* buffer );</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;sl_status_t wf200_host_sdio_transfer_cmd53( wf200_host_bus_tranfer_type_t type, uint8_t function, uint32_t address, uint8_t* buffer, uint16_t buffer_length );</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;sl_status_t wf200_host_sdio_enable_high_speed_mode( void );</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;```</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;## WF200 input buffers limit</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;When sending commands and frames to the WF200, the host has to manage the number of input buffers available on the WF200 side. The number of available buffers is shared in the startup indication during initialization.</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;The host must maintain the number of commands/frames not yet acknowledged by a confirmation. It can be done through a simple counter or by using a semaphore. The host API includes a dedicated function hook to manage this limit on the host side.</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;```c</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;sl_status_t wf200_host_transmit_frame( wf200_buffer_t* frame );</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;```</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;You can refer to the start up indication structure to retrieve the number of available input buffers (NumInpChBufs in ::HiStartupIndBody_t ).</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;## WF200 receive frame loop</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;The host is responsible for detecting an interrupt coming from WF200 and calling ::wf200_receive_frame. Depending on the returned status of ::wf200_receive_frame, the host has to either call the function again or stop the communication with the WF200. In addition, **the host will also have to manage the priority between the received frames and the packets to be sent from the host**.</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;The balance between RX and TX is use case dependent. It is up to the host to manage this balance in high throughput situations.</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;## wf200_host_post_event() implementation</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;The host has to manage the indications received from WF200. It is done through the wf200_host_post_event() function. The list of possible indications sent by WF200 can be found on the dedicated \ref indications page.</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;The information reported by each indication is described in wfx_fm_api.h.</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;## Integration Steps</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;When integrating the FMAC driver into a new system these are the recommended steps.</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;### 1. Implement host functions for communication bus and OS</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;Implement the bus communication functions for SPI or SDIO and the other functions described above.</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;### 2. Test bus communication</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;Refer to the details in the \ref wf200_initialization page for each initialization step and make sure configuration is completely successfully.</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;### 3. Use the WF200 FMAC driver API to initiate a WiFi connection and send/receive data</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;This step requires implementing the receive frame loop as described above.</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>wf200_host_req.md</b></li>
    <li class="footer">Generated on Fri Jan 4 2019 18:00:56 for WF200 FMAC driver by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
