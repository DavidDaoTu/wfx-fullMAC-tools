<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WF200 FMAC driver: Host requirements</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WF200 FMAC driver
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('wf200_host_req.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Host requirements </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A microcontroller host can use the FMAC driver to access the Wi-Fi capabilities of the WF200. In order to do so, the host has several requirements that are described below.</p>
<h2>Bus communication</h2>
<p>The first requirement of the host is to support either SPI or SDIO communication.</p>
<h3>SPI bus</h3>
<p>The WF200 supports SPI 8-bit up to 50MHz. In addition to the SPI connections (MISO, MOSI, clock), the host will require two GPIOs to manage the chip select and interrupt functionalities. You can refer to <a class="el" href="wf200_hardware.html">WF200 hardware overview</a> to connect the host to WF200. The chip select is active in the reset state and the interrupt is detected on a rising edge. In case of power save features support, the host will require an additional GPIO (GPIO_WUP) for the wake-up functionality.</p>
<h3>SDIO bus</h3>
<p>The WF200 supports SDIO 4-bit up to 50MHz. By default, the interrupt occurs on the SDIO data line 1. This can be changed using the PDS (<a class="el" href="wf200_pds.html">Platform Data Set</a>) enabling the interrupt on the GPIO_WIRQ pin. This option can be useful in case of power save support. The WF200 follows the SDIO specification ver 2.0. In case of power save features support, the host has to manage an additional GPIO (GPIO_WUP) for the wake-up functionality.</p>
<h2>Host memory requirements</h2>
<h3>Flash memory</h3>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>add flash memory requirements</dd></dl>
<h3>RAM memory</h3>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>add ram memory requirements</dd></dl>
<h2>Host API functions implementation</h2>
<p>The host has to implement a set of functions to enable the driver to access multiple resources (Firmware, GPIOs, memory, busses...). The implementation of these functions are dependent on the platform and type of operating system used. The list of functions required to be implemented by the host are located in the <a class="el" href="wf200__host__api_8h.html" title="wf200_host_api.h contains the definitions of the functions to be implemented by the host MCU...">wf200_host_api.h</a> file.</p>
<p>The first set of functions is responsible of initializing the host and retrieving the firmware information. </p><div class="fragment"><div class="line">sl_status_t wf200_host_init( <span class="keywordtype">void</span> );</div><div class="line">sl_status_t wf200_host_get_firmware_data( <span class="keyword">const</span> uint8_t** data, uint32_t data_size );</div><div class="line">sl_status_t wf200_host_get_firmware_size( uint32_t* firmware_size );</div><div class="line">sl_status_t wf200_host_deinit( <span class="keywordtype">void</span> );</div></div><!-- fragment --><p> The host also needs to provide GPIO access to the FMAC driver. </p><div class="fragment"><div class="line">sl_status_t wf200_host_reset_chip( <span class="keywordtype">void</span> );</div><div class="line">sl_status_t wf200_host_set_wake_up_pin( uint8_t state );</div><div class="line">sl_status_t wf200_host_hold_in_reset( <span class="keywordtype">void</span> );</div></div><!-- fragment --><p> In addition, several functions serve to manage the confirmations and indications coming from WF200. </p><div class="fragment"><div class="line">sl_status_t wf200_host_wait_for_confirmation( uint32_t timeout, <span class="keywordtype">void</span>** event_payload_out );</div><div class="line">sl_status_t wf200_host_wait( uint32_t wait_time );</div><div class="line">sl_status_t wf200_host_post_event( uint32_t event_id, <span class="keywordtype">void</span>* event_payload, uint32_t event_payload_length );</div></div><!-- fragment --><p> These functions allocate or free memory. </p><div class="fragment"><div class="line">sl_status_t wf200_host_allocate_buffer( <a class="code" href="wf200__constants_8h.html#structwf200__buffer__t">wf200_buffer_t</a>** buffer, wf200_buffer_type_t type, uint32_t buffer_size, uint32_t wait_duration );</div><div class="line">sl_status_t wf200_host_free_buffer( <a class="code" href="wf200__constants_8h.html#structwf200__buffer__t">wf200_buffer_t</a>* buffer, wf200_buffer_type_t type );</div></div><!-- fragment --><p> The last set of required functions are to support the chosen communication bus. </p><div class="fragment"><div class="line"><span class="comment">/* WF200 host bus API */</span></div><div class="line">sl_status_t wf200_host_init_bus( <span class="keywordtype">void</span> );</div><div class="line">sl_status_t wf200_host_enable_platform_interrupt( <span class="keywordtype">void</span> );</div><div class="line">sl_status_t wf200_host_disable_platform_interrupt( <span class="keywordtype">void</span> );</div><div class="line"><span class="comment">/* WF200 host SPI bus API */</span></div><div class="line">sl_status_t wf200_host_spi_cs_assert( <span class="keywordtype">void</span> );</div><div class="line">sl_status_t wf200_host_spi_cs_deassert(<span class="keywordtype">void</span> );</div><div class="line">sl_status_t wf200_host_spi_transfer_no_cs_assert( sl_wifi_bus_tranfer_type_t type, uint8_t* buffer, uint16_t buffer_length );</div><div class="line"><span class="comment">/* WF200 host SDIO bus API */</span></div><div class="line">sl_status_t wf200_host_sdio_transfer_cmd52( wf200_host_bus_tranfer_type_t type, uint8_t <span class="keyword">function</span>, uint32_t address, uint8_t* buffer );</div><div class="line">sl_status_t wf200_host_sdio_transfer_cmd53( wf200_host_bus_tranfer_type_t type, uint8_t <span class="keyword">function</span>, uint32_t address, uint8_t* buffer, uint16_t buffer_length );</div><div class="line">sl_status_t wf200_host_sdio_enable_high_speed_mode( <span class="keywordtype">void</span> );</div></div><!-- fragment --><h2>WF200 input buffers limit</h2>
<p>When sending commands and frames to the WF200, the host has to manage the number of input buffers available on the WF200 side. The number of available buffers is shared in the startup indication during initialization. The host must maintain the number of commands/frames not yet acknowledged by a confirmation. It can be done through a simple counter or by using a semaphore. The host API includes a dedicated function hook to manage this limit on the host side. </p><div class="fragment"><div class="line">sl_status_t wf200_host_transmit_frame( <a class="code" href="wf200__constants_8h.html#structwf200__buffer__t">wf200_buffer_t</a>* frame );</div></div><!-- fragment --> <dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd>add startup indication ref.</dd></dl>
<h2>WF200 receive frame loop</h2>
<p>The host is responsible for detecting an interrupt coming from WF200 and calling <a class="el" href="wf200_8h.html#ad3d3f73eabbb75b912e3b56dc2821b7d" title="Receive available frame from wf200. ">wf200_receive_frame</a>. Depending on the returned status of <a class="el" href="wf200_8h.html#ad3d3f73eabbb75b912e3b56dc2821b7d" title="Receive available frame from wf200. ">wf200_receive_frame</a>, the host has to either call the function again or stop the communication with the WF200. In addition, <b>the host will also have to manage the priority between the received frames and the packets to be sent from the host</b>. The balance between RX and TX is use case dependent. It is up to the host to manage this balance in high throughput situations.</p>
<h2>wf200_host_post_event() implementation</h2>
<p>The host has to manage the indications received from WF200. It is done through the wf200_host_post_event() function. The list of possible indications sent by WF200 can be found on the dedicated <a class="el" href="wf200_fmac_api.html#indications">indications</a> page. The information reported by each indication is described in wfx_fm_api.h.</p>
<h2>Integration Steps</h2>
<p>When integrating the FMAC driver into a new system these are the recommended steps.</p>
<h3>1. Implement host functions for communication bus and OS</h3>
<p>Implement the bus communication functions for SPI or SDIO and the other functions described above.</p>
<h3>2. Test bus communication</h3>
<p>Refer to the details in the <a class="el" href="wf200_initialization.html">Initialization and configuration</a> page for each initialization step and make sure configuration is completely successfully.</p>
<h3>3. Use the WF200 FMAC driver API to initiate a WiFi connection and send/receive data</h3>
<p>This step requires implementing the receive frame loop as described above. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="wf200_fmac_driver.html">FMAC driver</a></li>
    <li class="footer">Generated on Thu Jan 3 2019 12:29:06 for WF200 FMAC driver by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
